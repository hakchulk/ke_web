<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì‹¬í”Œ ToDo ë¦¬ìŠ¤íŠ¸</title>
    <!-- Bootstrap 5.3 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      /* ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼: ì™„ë£Œëœ í•­ëª© ì²˜ë¦¬ */
      .task-completed {
        text-decoration: line-through;
        color: #6c757d !important; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½ */
      }
      /* ë¦¬ìŠ¤íŠ¸ í•­ëª©ì˜ hover íš¨ê³¼ë¥¼ ì•½ê°„ ë” ë¶€ë“œëŸ½ê²Œ */
      .list-group-item:hover {
        background-color: #f8f9fa;
      }
      /* ì²´í¬ë°•ìŠ¤ ë ˆì´ë¸”ì˜ í°íŠ¸ í¬ê¸° ì¡°ì • */
      .task-label {
        font-size: 1.15rem; /* fs-5ì™€ ë¹„ìŠ·í•˜ê²Œ */
        margin-left: 0.5rem;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
          <!-- ToDo App Main Card -->
          <div class="card shadow-lg border-0 rounded-4">
            <div
              class="card-header bg-primary text-white text-center py-3 rounded-top-4"
            >
              <h1 class="h3 mb-0">ì˜¤ëŠ˜ì˜ í•  ì¼ ğŸ“</h1>
            </div>
            <div class="card-body p-4">
              <!-- Task Input Form -->
              <div class="input-group mb-4 shadow-sm">
                <input
                  type="text"
                  id="newTaskInput"
                  class="form-control form-control-lg border-primary"
                  placeholder="ìƒˆë¡œìš´ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
                  aria-label="New task input"
                />
                <button
                  class="btn btn-primary"
                  type="button"
                  id="addTaskButton"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="currentColor"
                    class="bi bi-plus-lg"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2z"
                    />
                  </svg>
                </button>
              </div>

              <!-- Task Filter/Controls -->
              <div
                class="d-flex justify-content-between mb-3 border-bottom pb-2"
              >
                <div
                  class="btn-group"
                  role="group"
                  id="filterGroup"
                  aria-label="Task filters"
                >
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-primary active"
                    data-filter="all"
                  >
                    ì „ì²´
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-primary"
                    data-filter="active"
                  >
                    í•  ì¼
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-primary"
                    data-filter="completed"
                  >
                    ì™„ë£Œ
                  </button>
                </div>
                <div class="d-flex gap-2">
                  <!-- JSì—ì„œ ìƒíƒœì— ë”°ë¼ í´ë˜ìŠ¤ì™€ í…ìŠ¤íŠ¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. -->
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                    id="completeAllButton"
                  >
                    ì „ì²´ ì™„ë£Œ
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-danger"
                    id="deleteAllFilteredButton"
                  >
                    í•„í„° ëª©ë¡ ì‚­ì œ
                  </button>
                </div>
              </div>

              <!-- ToDo List Container -->
              <ul class="list-group list-group-flush" id="todoList">
                <!-- Tasks will be dynamically inserted here -->
              </ul>
              <!-- End ToDo List -->
            </div>
            <div
              class="card-footer text-center text-muted small py-3"
              id="todoCount"
            >
              ë‚¨ì€ í•  ì¼: 0ê°œ
            </div>
          </div>
          <!-- End Main Card -->
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle CDN -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      // --- 1. ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ ê´€ë¦¬ ---
      const TODO_STORAGE_KEY = "simpleTodoListTasks";
      let tasks = [];
      let currentFilter = "all";

      // DOM ìš”ì†Œ ì°¸ì¡°
      const todoList = document.getElementById("todoList");
      const newTaskInput = document.getElementById("newTaskInput");
      const addTaskButton = document.getElementById("addTaskButton");
      const filterGroup = document.getElementById("filterGroup");
      const completeAllButton = document.getElementById("completeAllButton");
      const todoCount = document.getElementById("todoCount");
      const deleteAllFilteredButton = document.getElementById(
        "deleteAllFilteredButton"
      );

      // --- 2. LocalStorage CRUD ê¸°ëŠ¥ ---

      /**
       * LocalStorageì—ì„œ í•  ì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
       */
      function loadTasks() {
        try {
          const storedTasks = localStorage.getItem(TODO_STORAGE_KEY);
          tasks = storedTasks ? JSON.parse(storedTasks) : [];
        } catch (error) {
          console.error("í•  ì¼ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          tasks = [];
        }
      }

      /**
       * í˜„ì¬ í•  ì¼ ëª©ë¡(tasks)ì„ LocalStorageì— ì €ì¥í•©ë‹ˆë‹¤.
       */
      function saveTasks() {
        try {
          localStorage.setItem(TODO_STORAGE_KEY, JSON.stringify(tasks));
          updateFooter(); // ì €ì¥ í›„ í‘¸í„° ë° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        } catch (error) {
          console.error("í•  ì¼ ëª©ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        }
      }

      // --- 3. UI ë Œë”ë§ ë° ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ---

      /**
       * í•  ì¼ ëª©ë¡ì„ HTMLë¡œ ë³€í™˜í•˜ì—¬ ë Œë”ë§í•©ë‹ˆë‹¤.
       */
      function renderTasks() {
        // 1. í˜„ì¬ í•„í„°ì— ë§ëŠ” í•­ëª©ë§Œ ì„ íƒ
        const filteredTasks = tasks.filter((task) => {
          if (currentFilter === "active") return !task.completed;
          if (currentFilter === "completed") return task.completed;
          return true; // 'all'
        });

        // 2. HTML ìƒì„±
        todoList.innerHTML = filteredTasks
          .map((task) => {
            const checked = task.completed ? "checked" : "";
            const completedClass = task.completed ? "task-completed" : "";
            const emoji = task.completed ? "âœ…" : "â³";

            return `
                    <li class="list-group-item d-flex justify-content-between align-items-center py-3 ${completedClass}" data-id="${task.id}">
                        <div class="form-check d-flex align-items-center">
                            <input class="form-check-input" type="checkbox" ${checked} data-action="toggle" id="task-${task.id}">
                            <label class="form-check-label task-label ms-2" for="task-${task.id}">
                                ${emoji} ${task.text}
                            </label>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger border-0" data-action="delete" title="ì‚­ì œ">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                        </button>
                    </li>
                `;
          })
          .join("");

        // 3. ëª©ë¡ì´ ë¹„ì—ˆì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
        if (filteredTasks.length === 0 && tasks.length > 0) {
          todoList.innerHTML = `<li class="list-group-item text-center text-muted py-3">ì„ íƒí•œ í•„í„°ì—ëŠ” í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</li>`;
        } else if (tasks.length === 0) {
          todoList.innerHTML = `<li class="list-group-item text-center text-muted py-3">ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</li>`;
        }
      }

      /**
       * í‘¸í„°ì— ë‚¨ì€ í•  ì¼ ê°œìˆ˜ì™€ 'ì „ì²´ ì™„ë£Œ' ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
       */
      function updateFooter() {
        const activeCount = tasks.filter((t) => !t.completed).length;
        const totalCount = tasks.length;

        // 1. í‘¸í„° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        todoCount.textContent = `ë‚¨ì€ í•  ì¼: ${activeCount}ê°œ (ì´ ${totalCount}ê°œ)`;

        // 2. ë²„íŠ¼ ìƒíƒœ ë° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (í† ê¸€ ê¸°ëŠ¥)
        if (totalCount === 0) {
          // í•  ì¼ì´ ì—†ëŠ” ê²½ìš° ë²„íŠ¼ ë¹„í™œì„±í™” ë° ê¸°ë³¸ ìƒíƒœ
          completeAllButton.textContent = "ì „ì²´ ì™„ë£Œ";
          completeAllButton.disabled = true;
          deleteAllFilteredButton.disabled = true;
          completeAllButton.classList.remove("btn-warning", "text-dark");
          completeAllButton.classList.add("btn-outline-secondary");
        } else if (activeCount === 0) {
          // ëª¨ë“  í•  ì¼ì´ ì™„ë£Œëœ ê²½ìš°: 'ì™„ë£Œ ì·¨ì†Œ' ìƒíƒœ
          completeAllButton.textContent = "ì™„ë£Œ ì·¨ì†Œ";
          completeAllButton.disabled = false;
          deleteAllFilteredButton.disabled = false;
          completeAllButton.classList.remove("btn-outline-secondary");
          completeAllButton.classList.add("btn-warning", "text-dark");
        } else {
          // í•  ì¼ì´ ë‚¨ì•„ìˆëŠ” ê²½ìš°: 'ì „ì²´ ì™„ë£Œ' ìƒíƒœ
          completeAllButton.textContent = "ì „ì²´ ì™„ë£Œ";
          completeAllButton.disabled = false;
          deleteAllFilteredButton.disabled = false;
          completeAllButton.classList.remove("btn-warning", "text-dark");
          completeAllButton.classList.add("btn-outline-secondary");
        }
      }

      // --- 4. ë°ì´í„° ì¡°ì‘ ê¸°ëŠ¥ ---

      /**
       * ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
       */
      function addTask() {
        const text = newTaskInput.value.trim();
        if (text === "") {
          newTaskInput.focus();
          return;
        }

        const newTask = {
          // ê°„ë‹¨í•œ ìœ ë‹ˆí¬ ID ìƒì„±
          id: Date.now().toString(),
          text: text,
          completed: false,
        };

        tasks.push(newTask);
        newTaskInput.value = ""; // ì…ë ¥ì°½ ë¹„ìš°ê¸°

        saveTasks();
        renderTasks();
      }

      /**
       * íŠ¹ì • IDì˜ í•  ì¼ ì™„ë£Œ ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
       * @param {string} id - í† ê¸€í•  í•  ì¼ì˜ ID
       */
      function toggleTask(id) {
        const taskIndex = tasks.findIndex((t) => t.id === id);
        if (taskIndex > -1) {
          tasks[taskIndex].completed = !tasks[taskIndex].completed;
          saveTasks();
          renderTasks();
        }
      }

      /**
       * íŠ¹ì • IDì˜ í•  ì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.
       * @param {string} id - ì‚­ì œí•  í•  ì¼ì˜ ID
       */
      function deleteTask(id) {
        tasks = tasks.filter((t) => t.id !== id);
        saveTasks();
        renderTasks();
      }

      /**
       * 'ì „ì²´ ì™„ë£Œ' ë˜ëŠ” 'ì™„ë£Œ ì·¨ì†Œ' ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
       */
      function completeAllTasks() {
        const allCompleted = tasks.every((t) => t.completed);

        if (allCompleted) {
          // ì™„ë£Œ ì·¨ì†Œ (ëª¨ë‘ ë¯¸ì™„ë£Œ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸°)
          tasks = tasks.map((t) => ({ ...t, completed: false }));
        } else {
          // ì „ì²´ ì™„ë£Œ (ë¯¸ì™„ë£Œëœ í•­ëª©ì„ ëª¨ë‘ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½)
          tasks = tasks.map((t) => ({ ...t, completed: true }));
        }

        saveTasks();
        renderTasks();
      }

      /**
       * í˜„ì¬ í•„í„°ì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  í•  ì¼ ëª©ë¡ì„ ì‚­ì œí•©ë‹ˆë‹¤. (í™•ì¸ UIëŠ” ìƒëµ)
       */
      function deleteAllFilteredTasks() {
        let tasksToKeep = [];

        if (currentFilter === "all") {
          // 'ì „ì²´' í•„í„°: ëª¨ë“  í•  ì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.
          tasksToKeep = [];
        } else if (currentFilter === "active") {
          // 'í•  ì¼' í•„í„°: ë¯¸ì™„ë£Œ í•­ëª©(active)ì„ ì‚­ì œí•˜ê³ , ì™„ë£Œëœ í•­ëª©(completed)ë§Œ ë‚¨ê¹ë‹ˆë‹¤.
          tasksToKeep = tasks.filter((t) => t.completed);
        } else if (currentFilter === "completed") {
          // 'ì™„ë£Œ' í•„í„°: ì™„ë£Œëœ í•­ëª©(completed)ì„ ì‚­ì œí•˜ê³ , ë¯¸ì™„ë£Œ í•­ëª©(active)ë§Œ ë‚¨ê¹ë‹ˆë‹¤.
          tasksToKeep = tasks.filter((t) => !t.completed);
        } else {
          return;
        }

        if (tasksToKeep.length === tasks.length) {
          // ì‚­ì œí•  í•­ëª©ì´ ì—†ëŠ” ê²½ìš°
          return;
        }

        tasks = tasksToKeep;
        saveTasks();
        renderTasks();
      }

      /**
       * ëª©ë¡ í•„í„°ë¥¼ ë³€ê²½í•˜ê³  UIë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
       * @param {string} filter - 'all', 'active', 'completed' ì¤‘ í•˜ë‚˜
       */
      function setFilter(filter) {
        currentFilter = filter;

        // í•„í„° ë²„íŠ¼ì˜ Active ìƒíƒœ ì—…ë°ì´íŠ¸
        filterGroup.querySelectorAll("button").forEach((btn) => {
          if (btn.getAttribute("data-filter") === filter) {
            btn.classList.add("active");
          } else {
            btn.classList.remove("active");
          }
        });

        renderTasks();
      }

      // --- 5. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---

      // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", () => {
        loadTasks();
        renderTasks();
      });

      // 2. í•  ì¼ ì¶”ê°€ ì´ë²¤íŠ¸ (ë²„íŠ¼ í´ë¦­)
      addTaskButton.addEventListener("click", addTask);

      // 3. í•  ì¼ ì¶”ê°€ ì´ë²¤íŠ¸ (Enter í‚¤ ì…ë ¥)
      newTaskInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          addTask();
        }
      });

      // 4. ëª©ë¡ í•­ëª© ì´ë²¤íŠ¸ ìœ„ì„ (ì²´í¬ë°•ìŠ¤/ì‚­ì œ ë²„íŠ¼)
      todoList.addEventListener("click", (e) => {
        const target = e.target;
        const listItem = target.closest("li[data-id]");
        if (!listItem) return;

        const id = listItem.getAttribute("data-id");
        const action = target
          .closest("[data-action]")
          ?.getAttribute("data-action");

        if (
          action === "toggle" ||
          target.classList.contains("form-check-input")
        ) {
          toggleTask(id);
        } else if (action === "delete") {
          deleteTask(id);
        }
      });

      // 5. í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
      filterGroup.addEventListener("click", (e) => {
        const filterBtn = e.target.closest("button[data-filter]");
        if (filterBtn) {
          setFilter(filterBtn.getAttribute("data-filter"));
        }
      });

      // 6. ì „ì²´ ì™„ë£Œ/ë¯¸ì™„ë£Œ ë²„íŠ¼ ì´ë²¤íŠ¸
      completeAllButton.addEventListener("click", completeAllTasks);

      // 7. í•„í„° ëª©ë¡ ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ (ìƒˆë¡œ ì¶”ê°€ë¨)
      deleteAllFilteredButton.addEventListener("click", deleteAllFilteredTasks);
    </script>
  </body>
</html>
